---
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets"; // aca importamos la funciÃ³n Image
import { fetchFromAPI, STRAPI_BASE_URL } from "../../lib/conection.ts"; // aca importamos la funcion fetchFromAPI

interface NoticiaSingle { // aqui estan los datos de las noticias
    documentId: string;
    titulo: string;
    descripcion: string;
    fecha: string;
    imagen: {
        url: string;
    };
    categoria: string;
}

export async function getStaticPaths() { // aca se crean las rutas de las noticias
    const noticias = await fetchFromAPI('noticias'); // aca llamamos los datos del Collection Type: noticias

    return noticias.map((noticia: NoticiaSingle) => ({ // aqui se mapean las noticias
        params: { 
            slug: noticia.documentId
        },
        props: {
            noticia: noticia
        }
    }));
}

const { noticia }: {noticia: NoticiaSingle} = Astro.props; // aca se pasa el dato de la noticia
---
<Layout>
    <!-- Titulo e imagen -->
    <section class="py-12 bg-linear-to-l from-blue-400 to-gray-300 text-white">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row gap-8 items-start md:items-center">
                <Image
                    src={`${STRAPI_BASE_URL}${noticia.imagen.url}` || ''}
                    alt={noticia.titulo}
                    class="w-full md:w-1/3 h-48 object-cover rounded-lg shadow-md"
                    inferSize={true}
                />
                <div class="md:w-2/3 space-y-3">
                    <span class="inline-block bg-white/20 px-3 py-1 rounded-full text-sm mb-3">
                        {noticia.categoria}
                    </span>
                    <h1 class="text-3xl md:text-4xl font-bold mb-2">{noticia.titulo}</h1>
                    <p class="text-sm text-white/90">
                        {noticia.fecha}
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Descripcion y boton de volver al inicio -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4 max-w-3xl">
            <p class="text-gray-700 leading-relaxed mb-4">{noticia.descripcion}</p>
            <div class="mt-10">
                <a href="/" class="inline-block bg-blue-400 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-300">
                    > Volver al Inicio
                </a>
            </div>
        </div>
    </section>
</Layout>